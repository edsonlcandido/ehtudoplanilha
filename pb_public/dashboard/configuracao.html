<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./favicon.svg" type="image/svg+xml">
    <title>Configura√ß√£o - Seu App Financeiro</title>
    <link rel="stylesheet" href="../css/picnic.css">
    <link rel="stylesheet" href="../css/style.css">
    <!-- SDK PocketBase -->
    <script src="../js/pocketbase/dist/pocketbase.umd.js"></script>
    <style>
        /* Ajustes espec√≠ficos desta p√°gina para mobile */
        body {
            max-width: 100vw;
            overflow-x: hidden;
        }

        /* Wrapper para permitir padding lateral no mobile sem afetar outros .container globais */
        .config-page-wrapper {
            width: 100%;
        }

        /* A√ß√µes da planilha: desktop permanece como antes (linha √∫nica). Apenas mobile empilha. */
        @media (max-width: 680px) {
            .sheet-actions {
                flex-direction: column;
                gap: .75rem !important;
            }

            .sheet-actions button {
                width: 100%;
                white-space: normal;
                word-break: break-word;
            }
        }

        @media (max-width: 768px) {
            .config-page-wrapper {
                padding: 0 1rem;
                box-sizing: border-box;
            }

            .config-page-wrapper .solution-card {
                margin-left: 0;
                margin-right: 0;
            }

            /* Garante que nenhum elemento interno force overflow */
            .config-page-wrapper * {
                max-width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- NAV: menu din√¢mico igual ao index.html -->
    <nav>
        <a href="/" class="brand">
            <span>Planilha Eh Tudo</span>
        </a>
        <input id="bmenub" type="checkbox" class="show">
        <label for="bmenub" class="burger pseudo button">menu</label>
        <div class="menu" id="menu-user">
            <a href="#" class="pseudo button icon-picture">Demo</a>
            <a href="../login.html" class="button icon-puzzle" id="loginBtn">Login</a>
            <a href="../registro.html" class="button icon-user" id="registerBtn">Registrar</a>
        </div>
    </nav>

    <!-- Container principal com menu lateral -->
    <div class="app-container">
        <!-- Menu lateral fixo -->
        <aside class="sidebar-menu">
            <a href="index.html" title="Dashboard">
                <span class="menu-icon">üè†</span>
                <span class="menu-text">Dashboard</span>
            </a>
            <a href="lancamentos.html" title="Lan√ßamentos">
                <span class="menu-icon">üìã</span>
                <span class="menu-text">Lan√ßamentos</span>
            </a>
        </aside>

        <!-- Conte√∫do principal rol√°vel -->
        <main class="main-content">
            <!-- SECTION MAIN: conte√∫do principal ocupando toda tela -->
            <section class="section section-light"
                style="min-height: 70vh; display: flex; align-items: center; justify-content: center;">
                <div class="container config-page-wrapper">
                    <h2 style="text-align: center; margin-bottom: 3rem;">Configura√ß√£o do Dashboard</h2>
                    <p
                        style="text-align: center; margin-bottom: 3rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                        Configure sua conta para integrar com o Google Drive e selecione sua planilha de controle
                        financeiro.
                    </p>

                    <!-- Grid com os dois cart√µes de configura√ß√£o -->
                    <div style="max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 2rem;">
                        <!-- Cart√£o 1: Autoriza√ß√£o Google Drive -->
                        <div id="google-auth-card" class="solution-card"
                            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px;">
                            <div>
                                <h3>Autoriza√ß√£o Google Drive</h3>
                                <p>Autorize o acesso ao Google Drive. Ap√≥s a autoriza√ß√£o, voc√™ poder√° selecionar ou
                                    criar uma planilha para uso.</p>
                            </div>
                            <div style="margin-top: auto; padding-top: 1.5rem;">
                                <button id="google-auth-button" class="button primary large" style="width: 100%;"
                                    disabled>
                                    Carregando...
                                </button>
                            </div>
                        </div>
                        <!-- Cart√£o 2: Planilha Atual -->
                        <div id="current-sheet-card" class="solution-card"
                            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px;">
                            <div>
                                <h3>Planilha Atual</h3>
                                <p id="current-sheet-name" style="font-weight: bold; color: #2196f3;">Nenhuma planilha
                                    selecionada</p>
                                <p id="current-sheet-description">Voc√™ ainda n√£o possui uma planilha configurada.</p>
                            </div>
                            <div class="sheet-actions"
                                style="margin-top: auto; padding-top: 1.5rem; display: flex; gap: 0.5rem;">
                                <button class="button secondary" style="flex: 1;" id="provisionSheetBtn">
                                    Copiar Template
                                </button>
                                <button class="button warning" style="flex: 1; display: none;" id="clearSheetBtn">
                                    Limpar Conte√∫do de exemplo
                                </button>
                                <button class="button error" style="flex: 1; display: none;" id="deleteSheetConfigBtn">
                                    Desvincular Planilha
                                </button>
                            </div>
                        </div>

                        <!-- Cart√£o 3: Sele√ß√£o da Planilha -->
                        <div class="solution-card"
                            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px;">
                            <div>
                                <h3>Gerenciar Planilha</h3>
                                <p>Selecione uma planilha existente para os lan√ßamentos financeiros.</p>
                            </div>
                            <div style="margin-top: auto; padding-top: 1.5rem;">
                                <button class="button primary large" style="width: 100%;" id="selectSheetBtn">
                                    Selecionar Planilha
                                </button>
                            </div>
                        </div>


                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para sele√ß√£o de planilha -->
    <div class="modal" id="sheetsModal">
        <input type="checkbox" id="modal_sheets">
        <label for="modal_sheets" class="overlay" id="modalOverlay"></label>
        <article>
            <header>
                <h3>Selecionar Planilha Google Sheets</h3>
                <label for="modal_sheets" class="close">&times;</label>
            </header>
            <section class="content" id="modalContent">
                <div id="loadingState" style="text-align: center; padding: 2rem;">
                    <p>Carregando suas planilhas...</p>
                </div>
                <div id="errorState" style="display: none; text-align: center; padding: 2rem;">
                    <p id="errorMessage" style="color: #e74c3c;">Erro ao carregar planilhas.</p>
                    <button class="button" id="retryBtn">Tentar Novamente</button>
                </div>
                <div id="sheetsListState" style="display: none;">
                    <p>Selecione uma planilha da lista abaixo:</p>
                    <div id="sheetsList" style="max-height: 300px; overflow-y: auto; margin: 1rem 0;">
                        <!-- Lista de planilhas ser√° inserida aqui -->
                    </div>
                </div>
            </section>
            <footer>
                <!-- Bot√µes alinhados lado a lado: esquerdo azul (primary), direito verde (success) -->
                <div style="display: flex; gap: 0.75rem; width: 100%;">
                    <button class="button secondary" style="flex: 1;" id="cancelBtn">Cancelar</button>
                    <button class="button success" style="flex: 1; display: none;" id="confirmBtn">Confirmar
                        Sele√ß√£o</button>
                </div>
            </footer>
        </article>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Planilha Eh Tudo. Simplificando suas finan√ßas.</p>
        </div>
        <p>
            <small>Produzido por
                <a href="https://www.ehtudo.app">Eh!Tudo.app</a></small>
        </p>
    </footer>
    <!-- Script PocketBase e verifica√ß√£o imediata de autentica√ß√£o -->
    <script type="module">
        import apiConfig from '../js/config/api-config.js';
        import { estaAutenticado } from '../js/auth-service.js';
        import { inicializarMenuUsuario } from '../js/menu-usuario.js';

        // Inicializa PocketBase
        window.pb = new PocketBase(apiConfig.getBaseURL());

        // Verifica autentica√ß√£o imediatamente (antes de carregar demais m√≥dulos)
        if (!estaAutenticado()) {
            // Redireciona rapidamente para evitar piscar conte√∫do protegido
            window.location.href = '../login.html';
        } else {
            // Inicializa menu do usu√°rio
            inicializarMenuUsuario();

            // Carrega m√≥dulos adicionais somente se autenticado
            Promise.all([
                import('../js/protecao-dashboard.js'),
                import('../js/configuracao.js'),
                import('../js/sheets-manager.js')
            ]).catch(err => console.error('Erro ao carregar m√≥dulos do dashboard:', err));
        }
    </script>
</body>

</html>