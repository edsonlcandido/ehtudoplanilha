<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuração - Seu App Financeiro</title>
    <link rel="stylesheet" href="../css/picnic.css">
    <link rel="stylesheet" href="../css/style.css">
    <!-- SDK PocketBase -->
    <script src="../js/pocketbase/dist/pocketbase.umd.js"></script>
    <style>
        /* Ajustes específicos desta página para mobile */
        body { max-width:100vw; overflow-x:hidden; }
        /* Wrapper para permitir padding lateral no mobile sem afetar outros .container globais */
        .config-page-wrapper { width:100%; }
        /* Ações da planilha: desktop permanece como antes (linha única). Apenas mobile empilha. */
        @media (max-width: 680px) {
            .sheet-actions { flex-direction: column; gap: .75rem !important; }
            .sheet-actions button { width:100%; white-space: normal; word-break: break-word; }
        }
        @media (max-width: 768px) {
            .config-page-wrapper { padding: 0 1rem; box-sizing: border-box; }
            .config-page-wrapper .solution-card { margin-left:0; margin-right:0; }
            /* Garante que nenhum elemento interno force overflow */
            .config-page-wrapper * { max-width:100%; }
        }
    </style>
</head>

<body>
    <!-- NAV: menu dinâmico igual ao index.html -->
    <nav>
        <a href="/" class="brand">
            <span>Planilha Eh Tudo</span>
        </a>
        <input id="bmenub" type="checkbox" class="show">
        <label for="bmenub" class="burger pseudo button">menu</label>
        <div class="menu" id="menu-user">
            <a href="#" class="pseudo button icon-picture">Demo</a>
            <a href="../login.html" class="button icon-puzzle" id="loginBtn">Login</a>
            <a href="../registro.html" class="button icon-user" id="registerBtn">Registrar</a>
        </div>
    </nav>
    <!-- SECTION MAIN: conteúdo principal ocupando toda tela -->
    <section class="section section-light" style="min-height: 70vh; display: flex; align-items: center; justify-content: center;">
        <div class="container config-page-wrapper">
            <h2 style="text-align: center; margin-bottom: 3rem;">Configuração do Dashboard</h2>
            <p
                style="text-align: center; margin-bottom: 3rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                Configure sua conta para integrar com o Google Drive e selecione sua planilha de controle financeiro.
            </p>

            <!-- Grid com os dois cartões de configuração -->
            <div style="max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 2rem;">
                <!-- Cartão 1: Autorização Google Drive -->
                <div id="google-auth-card" class="solution-card"
                    style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px;">
                    <div>
                        <h3>Autorização Google Drive</h3>
                        <p>Autorize o acesso ao Google Drive. Após a autorização, você poderá selecionar ou criar uma planilha para uso.</p>
                    </div>
                    <div style="margin-top: auto; padding-top: 1.5rem;">
                        <button id="google-auth-button" class="button primary large" style="width: 100%;" disabled>
                            Carregando...
                        </button>
                    </div>
                </div>
                <!-- Cartão 2: Planilha Atual -->
                <div id="current-sheet-card" class="solution-card"
                    style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px;">
                    <div>
                        <h3>Planilha Atual</h3>
                        <p id="current-sheet-name" style="font-weight: bold; color: #2196f3;">Nenhuma planilha
                            selecionada</p>
                        <p id="current-sheet-description">Você ainda não possui uma planilha configurada.</p>
                    </div>
                    <div class="sheet-actions" style="margin-top: auto; padding-top: 1.5rem; display: flex; gap: 0.5rem;">
                        <button class="button secondary" style="flex: 1;" id="provisionSheetBtn">
                            Copiar Template
                        </button>
                        <button class="button warning" style="flex: 1; display: none;" id="clearSheetBtn">
                            Limpar Conteúdo de exemplo
                        </button>
                        <button class="button error" style="flex: 1; display: none;" id="deleteSheetConfigBtn">
                            Desvincular Planilha
                        </button>
                    </div>
                </div>

                <!-- Cartão 3: Seleção da Planilha -->
                <div class="solution-card"
                    style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px;">
                    <div>
                        <h3>Gerenciar Planilha</h3>
                        <p>Selecione uma planilha existente para os lançamentos financeiros.</p>
                    </div>
                    <div style="margin-top: auto; padding-top: 1.5rem;">
                        <button class="button primary large" style="width: 100%;" id="selectSheetBtn">
                            Selecionar Planilha
                        </button>
                    </div>
                </div>


            </div>
        </div>
    </section>

    <!-- Modal para seleção de planilha -->
    <div class="modal" id="sheetsModal">
        <input type="checkbox" id="modal_sheets">
        <label for="modal_sheets" class="overlay" id="modalOverlay"></label>
        <article>
            <header>
                <h3>Selecionar Planilha Google Sheets</h3>
                <label for="modal_sheets" class="close">&times;</label>
            </header>
            <section class="content" id="modalContent">
                <div id="loadingState" style="text-align: center; padding: 2rem;">
                    <p>Carregando suas planilhas...</p>
                </div>
                <div id="errorState" style="display: none; text-align: center; padding: 2rem;">
                    <p id="errorMessage" style="color: #e74c3c;">Erro ao carregar planilhas.</p>
                    <button class="button" id="retryBtn">Tentar Novamente</button>
                </div>
                <div id="sheetsListState" style="display: none;">
                    <p>Selecione uma planilha da lista abaixo:</p>
                    <div id="sheetsList" style="max-height: 300px; overflow-y: auto; margin: 1rem 0;">
                        <!-- Lista de planilhas será inserida aqui -->
                    </div>
                </div>
            </section>
            <footer>
                <!-- Botões alinhados lado a lado: esquerdo azul (primary), direito verde (success) -->
                <div style="display: flex; gap: 0.75rem; width: 100%;">
                    <button class="button secondary" style="flex: 1;" id="cancelBtn">Cancelar</button>
                    <button class="button success" style="flex: 1; display: none;" id="confirmBtn">Confirmar Seleção</button>
                </div>
            </footer>
        </article>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Planilha Eh Tudo. Simplificando suas finanças.</p>
        </div>
        <p>
            <small>Produzido por
                <a href="https://www.ehtudo.app">Eh!Tudo.app</a></small>
        </p>
    </footer>
    <!-- Script PocketBase e módulos da aplicação -->
    <script type="module">
        import apiConfig from '../js/config/api-config.js';
        import { inicializarMenuUsuario } from '../js/menu-usuario.js';

        // Inicializa o PocketBase globalmente antes dos módulos
        window.pb = new PocketBase(apiConfig.getBaseURL());

        inicializarMenuUsuario();

        setTimeout(() => {
            import('../js/protecao-dashboard.js')
                .then(() => {
                    console.log('Módulo de proteção do dashboard carregado com sucesso.');
                })
                .catch(err => {
                    console.error('Erro ao carregar o módulo de proteção do dashboard:', err);
                });
        }, 100); // Aguarda 100 milissegundos para garantir que a autenticação seja verificada
    </script>
    <script src="../js/configuracao.js" type="module"></script>
    <script type="module" src="../js/sheets-manager.js"></script>
</body>

</html>