import{p as t,A as o,C as s,b as c}from"./auth.js";class n{static async checkRefreshToken(){try{return(await t.send(o.checkRefreshToken,{method:"GET"})).hasRefreshToken}catch(e){return console.error("[SheetsService] Erro ao verificar refresh token:",e),!1}}static async listGoogleSheets(){try{return(await t.send(o.listGoogleSheets,{method:"GET"})).sheets||[]}catch(e){throw console.error("[SheetsService] Erro ao listar planilhas:",e),e}}static async saveSheetId(e,r){try{await t.send(o.saveSheetId,{method:"POST",body:{sheet_id:e,sheet_name:r}}),console.log("[SheetsService] Invalidando caches após mudar planilha"),s.clear(c.SHEET_ENTRIES),s.clear(c.SHEET_CATEGORIES),s.clear(c.SHEET_CATEGORIES_COMPLETE)}catch(a){throw console.error("[SheetsService] Erro ao salvar sheet ID:",a),a}}static async provisionSheet(){try{return await t.send(o.provisionSheet,{method:"POST"})}catch(e){throw console.error("[SheetsService] Erro ao provisionar planilha:",e),e}}static async getCurrentSheet(){try{return await t.send(o.getCurrentSheet,{method:"GET"})}catch(e){return console.error("[SheetsService] Erro ao obter planilha atual:",e),{}}}static async getConfigStatus(){try{return await t.send(o.configStatus,{method:"GET"})}catch(e){return console.error("[SheetsService] Erro ao obter status:",e),{hasRefreshToken:!1,hasSheetId:!1}}}static async appendEntry(e){try{await t.send(o.appendEntry,{method:"POST",body:e}),console.log("[SheetsService] Invalidando caches após adicionar lançamento"),s.clear(c.SHEET_ENTRIES),s.clear(c.SHEET_CATEGORIES),s.clear(c.SHEET_CATEGORIES_COMPLETE)}catch(r){throw console.error("[SheetsService] Erro ao adicionar lançamento:",r),r}}static async editEntry(e,r){try{await t.send(o.editSheetEntry,{method:"PUT",body:{rowIndex:e,...r}}),console.log("[SheetsService] Invalidando caches após editar lançamento"),s.clear(c.SHEET_ENTRIES),s.clear(c.SHEET_CATEGORIES),s.clear(c.SHEET_CATEGORIES_COMPLETE)}catch(a){throw console.error("[SheetsService] Erro ao editar lançamento:",a),a}}static async deleteEntry(e){try{await t.send(o.deleteSheetEntry,{method:"DELETE",body:{rowIndex:e}}),console.log("[SheetsService] Invalidando caches após deletar lançamento"),s.clear(c.SHEET_ENTRIES),s.clear(c.SHEET_CATEGORIES),s.clear(c.SHEET_CATEGORIES_COMPLETE)}catch(r){throw console.error("[SheetsService] Erro ao deletar lançamento:",r),r}}static async getSheetEntries(e,r){try{return(await t.send(`${o.getSheetEntries}?month=${e}&year=${r}`,{method:"GET"})).entries||[]}catch(a){throw console.error("[SheetsService] Erro ao obter lançamentos:",a),a}}static async getFinancialSummary(e,r){try{return await t.send(`${o.getFinancialSummary}?month=${e}&year=${r}`,{method:"GET"})}catch(a){throw console.error("[SheetsService] Erro ao obter resumo financeiro:",a),a}}static async getAvailableMonths(){try{return(await t.send(o.getAvailableMonths,{method:"GET"})).months||[]}catch(e){return console.error("[SheetsService] Erro ao obter meses disponíveis:",e),[]}}static async getSheetCategories(e=!1){if(!e){const r=s.get(c.SHEET_CATEGORIES);if(r)return console.log("[SheetsService] Usando categorias do cache"),r.categories||[]}try{console.log("[SheetsService] Buscando categorias do servidor");const r=await t.send(o.getSheetCategories,{method:"GET"});return s.set(c.SHEET_CATEGORIES,r),r.categories||[]}catch(r){return console.error("[SheetsService] Erro ao obter categorias:",r),[]}}static async getSheetCategoriesComplete(e=!1){if(!e){const r=s.get(c.SHEET_CATEGORIES_COMPLETE);if(r)return console.log("[SheetsService] Usando categorias completas do cache"),r.categoriesComplete||[]}try{console.log("[SheetsService] Buscando categorias completas do servidor");const r=await t.send(o.getSheetCategoriesComplete,{method:"GET"});return s.set(c.SHEET_CATEGORIES_COMPLETE,r),r.categoriesComplete||[]}catch(r){console.error("[SheetsService] Erro ao obter categorias completas:",r),console.log("[SheetsService] Tentando fallback para endpoint de categorias antigas");try{return(await n.getSheetCategories(e)).map(i=>({categoria:i,tipo:"",orcamento:0}))}catch(a){return console.error("[SheetsService] Erro no fallback:",a),[]}}}static async clearSheetContent(){try{await t.send(o.clearSheetContent,{method:"POST"})}catch(e){throw console.error("[SheetsService] Erro ao limpar planilha:",e),e}}static async deleteSheetConfig(){try{await t.send(o.deleteSheetConfig,{method:"POST"})}catch(e){throw console.error("[SheetsService] Erro ao deletar configuração:",e),e}}static async revokeGoogleAccess(){try{await t.send(o.revokeGoogleAccess,{method:"POST"})}catch(e){throw console.error("[SheetsService] Erro ao revogar acesso:",e),e}}static async refreshToken(){try{await t.send(o.googleRefreshToken,{method:"POST"})}catch(e){throw console.error("[SheetsService] Erro ao renovar token:",e),e}}}export{n as SheetsService,n as default};
