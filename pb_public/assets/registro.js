import{c as p,i as v,r as w,a as b}from"./auth.js";/* empty css     */import{A as d}from"./auth-oauth.js";let y=!1;function E(){const e=document.getElementById("registerForm"),t=document.getElementById("email"),i=document.getElementById("password"),n=document.getElementById("confirmPassword"),o=document.getElementById("submitButton"),s=document.getElementById("buttonText"),a=document.getElementById("buttonLoading"),c=document.getElementById("googleRegisterBtn"),l=document.getElementById("errorMsg"),u=document.getElementById("successMsg");return!e||!t||!i||!n||!o||!s||!a||!c||!l||!u?(console.error("Elementos do formulário de registro não encontrados"),null):{form:e,emailInput:t,passwordInput:i,confirmPasswordInput:n,submitButton:o,buttonText:s,buttonLoading:a,googleRegisterBtn:c,errorMsg:l,successMsg:u}}function g(e,t){e.errorMsg.textContent=t,e.errorMsg.style.display="block",e.successMsg.style.display="none"}function I(e,t){e.successMsg.textContent=t,e.successMsg.style.display="block",e.errorMsg.style.display="none"}function r(e){e.errorMsg.style.display="none",e.successMsg.style.display="none"}function f(e,t){y=t,e.submitButton.disabled=t,e.emailInput.disabled=t,e.passwordInput.disabled=t,e.confirmPasswordInput.disabled=t,t?(e.buttonText.style.display="none",e.buttonLoading.style.display="inline"):(e.buttonText.style.display="inline",e.buttonLoading.style.display="none")}function h(e){return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?{valid:!0}:{valid:!1,message:"E-mail inválido"}:{valid:!1,message:"E-mail é obrigatório"}}function B(e){return e?{valid:!0}:{valid:!1,message:"Senha é obrigatória"}}function M(e,t){return t?e!==t?{valid:!1,message:"As senhas não coincidem"}:{valid:!0}:{valid:!1,message:"Confirmação de senha é obrigatória"}}function L(e){const t=h(e.email);if(!t.valid)return t;const i=B(e.password);if(!i.valid)return i;const n=M(e.password,e.passwordConfirm);return n.valid?{valid:!0}:n}async function C(e){var n;if(y)return;r(e);const t={email:e.emailInput.value.trim(),password:e.passwordInput.value,passwordConfirm:e.confirmPasswordInput.value},i=L(t);if(!i.valid){g(e,i.message||"Erro de validação");return}f(e,!0);try{await window.pb.collection("users").create({email:t.email,emailVisibility:!0,password:t.password,passwordConfirm:t.passwordConfirm}),I(e,"Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{b()},1500)}catch(o){console.error("Erro ao registrar:",o);let s="Erro ao criar conta. Tente novamente.";if((n=o==null?void 0:o.response)!=null&&n.data){const a=o.response.data;a.email?s="Este e-mail já está cadastrado":a.password?s="Senha inválida. Use no mínimo 8 caracteres":a.passwordConfirm?s="As senhas não coincidem":a.message&&(s=a.message)}else o!=null&&o.message&&(s=o.message);g(e,s),f(e,!1)}}function R(e){e.form.addEventListener("submit",async t=>{t.preventDefault(),await C(e)})}function A(e){e.emailInput.addEventListener("input",()=>r(e)),e.passwordInput.addEventListener("input",()=>r(e)),e.confirmPasswordInput.addEventListener("input",()=>r(e))}function x(e){r(e),p.isDevelopment&&console.log("[Registro] Iniciando registro com Google OAuth..."),d.loginWithGoogle()}function T(e){e.googleRegisterBtn.addEventListener("click",async()=>{await x(e)})}async function m(){if(d.isOAuthCallback()){p.isDevelopment&&console.log("[Registro] Detectado callback OAuth, processando..."),await d.handleOAuthCallback();return}if(v()){w();return}const e=E();if(!e){console.error("Não foi possível inicializar a página de registro");return}R(e),A(e),T(e),console.log("✅ Página de registro inicializada")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m();
